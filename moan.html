<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الأيقونة - قسم البخور والعود</title>

    <meta property="og:title" content="بخور وعود - فاخرة">
    <meta property="og:description" content="اكتشف مجموعة من البخور والعود التي تعكس القوة والأناقة. رائحة تأسر الحواس.">
    <meta property="og:image" content="https://talalye1.github.io/Icon-perfumes/moan.jpg">
    <meta property="og:url" content="https://talalye1.github.io/Icon-perfumes/moan.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="متجر الأيقونة للعطور">

    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon.png" type="image/png">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <meta name="theme-color" content="#000000">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.css">
    <script type="module" src="https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>
    
    <style>
        /* (1/12) CSS Styles */
        :root {
            --gold: #D4AF37;
            --light-gold: #F5DEB3;
            --black: #0F0F0F;
            --dark-gray: #1A1A1A;
            --white: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--black);
            color: var(--white);
            position: relative;
            background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), 
                              url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><defs><pattern id="d" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M0 10h20M10 0v20" stroke-width="0.3" stroke="%23D4AF37"/></pattern></defs><rect width="100%" height="100%" fill="url(%23d)"/></svg>');
            background-size: 200px;
            overflow-x: hidden;
        }

        body::before {
            content: "";
            position: fixed;
            top: 5px; left: 5px; right: 5px; bottom: 5px;
            border: 1px solid var(--gold);
            pointer-events: none;
            z-index: 1000;
            border-radius: 10px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1, h2, h3 { color: var(--gold); }
        h2 { text-align: center; margin-bottom: 25px; font-size: 2.2rem; }

        /* --- Navigation Bar --- */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            background: rgba(15, 15, 15, 0.8);
            backdrop-filter: blur(10px);
            padding: 10px 0;
            border-bottom: 2px solid var(--gold);
            z-index: 990;
        }
        .nav-buttons { display: flex; gap: 5px; }
        .nav-btn {
            color: var(--gold);
            background: var(--black);
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: bold;
            border: 1px solid var(--gold);
            transition: all 0.3s ease;
        }
        .nav-btn:hover, .nav-btn.active {
            background: var(--gold);
            color: var(--black);
            box-shadow: 0 0 15px var(--gold);
        }
        
        main { padding-top: 80px; /* Space for fixed nav */ }

        /* --- Header Section --- */
        .header-content { text-align: center; margin-top: 20px; }
        .header-content .logo img {
            width: 100%;
            max-width: 600px;
            height: auto;
            border-radius: 15px;
            border: 3px solid var(--gold);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
        }
        .header-content h1 { margin: 20px 0 10px; font-size: 2.5rem; }
        .header-content p { color: var(--light-gold); margin-bottom: 20px; font-size: 1.1rem; }

        /* --- Download Button --- */
        #downloadBtn {
            background: var(--gold); color: var(--black); font-size: 1.1rem;
            border: none; padding: 12px 24px; border-radius: 8px;
            width: 100%; max-width: 400px; cursor: pointer; font-weight: bold;
            transition: all 0.3s;
        }
        #downloadBtn:hover { transform: scale(1.05); }
        #progressBar { height: 6px; width: 0; background: var(--gold); margin: 8px auto 0; transition: width 0.3s; max-width: 400px; border-radius: 6px; }

        /* --- Why Us Section --- */
        .why-us { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px; margin-top: 40px; }
        .feature-item { text-align: center; max-width: 250px; }
        .feature-item .icon { font-size: 2.5rem; color: var(--gold); margin-bottom: 10px; }
        .feature-item h3 { font-size: 1.3rem; margin-bottom: 5px; }
        .feature-item p { color: var(--light-gold); font-size: 0.95rem; }

        /* --- Products Section --- */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }
        .product-card {
            background: var(--dark-gray);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .product-card:hover { border-color: var(--gold); box-shadow: 0 0 20px rgba(212, 175, 55, 0.4); }
        .product-card img { width: 100%; height: 200px; object-fit: cover; border-radius: 10px; cursor: pointer; margin-bottom: 15px; }
        .product-card h3 { font-size: 1.4rem; color: var(--light-gold); }
        .product-info { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
        .price { font-size: 1.3rem; font-weight: bold; color: var(--gold); }
        .like-btn { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }
        .like-btn.liked { color: #ff6b6b; }
        .quantity-selector { display: flex; align-items: center; justify-content: center; gap: 10px; margin: 15px 0; }
        .quantity-selector button { background: var(--gold); color: var(--black); border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; }
        .quantity-selector input { width: 50px; text-align: center; background: var(--black); color: var(--white); border: 1px solid var(--gold); border-radius: 5px; padding: 5px; }
        .total-price { margin: 10px 0; font-weight: bold; }
        .buy-btn {
            background: var(--gold); color: var(--black); font-size: 1.1rem;
            border: none; padding: 10px 20px; border-radius: 8px; width: 100%;
            cursor: pointer; font-weight: bold; margin-top: 10px; transition: all 0.3s;
        }
        .buy-btn:hover { background: var(--light-gold); }
        .social-share { margin-top: 15px; }
        .social-share a { color: white; margin: 0 8px; font-size: 1.5rem; text-decoration: none; }
        .social-share a.facebook:hover { color: #1877F2; }
        .social-share a.twitter:hover { color: #1DA1F2; }
        .social-share a.whatsapp:hover { color: #25D366; }
        .social-share a.telegram:hover { color: #0088cc; }

        /* --- Modal (Popup) --- */
        .modal {
            position: fixed; z-index: 1001; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.7);
            display: none; justify-content: center; align-items: center;
        }
        .modal-content {
            background: var(--dark-gray);
            padding: 30px; border-radius: 15px;
            border: 2px solid var(--gold);
            width: 90%; max-width: 450px;
            text-align: center;
        }
        .modal-content h3 { margin-bottom: 20px; }
        .modal-content input {
            width: 100%; padding: 12px; margin-bottom: 20px;
            border-radius: 8px; border: 1px solid var(--gold);
            background: var(--black); color: var(--white); font-size: 1rem;
        }
        .modal-btn {
            background: var(--gold); color: var(--black); font-size: 1.1rem;
            border: none; padding: 12px 24px; border-radius: 8px;
            cursor: pointer; font-weight: bold; margin: 5px;
        }
        .modal-btn.close { background: #555; color: white; }
        
        /* --- Comments Section --- */
        #comments-section { background: var(--dark-gray); padding: 20px; border-radius: 15px; margin-top: 40px; }
        #comment-form { display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px; }
        #comment-form input, #comment-form textarea {
            padding: 10px; background: var(--black); color: var(--white);
            border: 1px solid var(--gold); border-radius: 8px;
        }
        #comment-form button {
            align-self: flex-start; background: var(--gold); color: var(--black);
            padding: 10px 20px; border-radius: 8px; font-weight: bold; border: none; cursor: pointer;
        }
        .comment {
            border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 10px;
        }
        .comment-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .comment-author { font-weight: bold; color: var(--gold); }
        .comment-date { font-size: 0.8rem; color: #aaa; }
        .comment-text { color: var(--light-gold); }
        .comment-actions { display: flex; gap: 15px; font-size: 0.9rem; color: #ccc; }
        .comment-actions button { background: none; border: none; color: #ccc; cursor: pointer; }
        .comment-actions button:hover { color: var(--gold); }

        /* --- Footer --- */
        footer { text-align: center; padding: 30px 20px; margin-top: 40px; background: var(--dark-gray); }
        .footer-social a { color: var(--gold); margin: 0 15px; font-size: 2rem; transition: all 0.3s; }
        .footer-social a:hover { color: var(--light-gold); transform: translateY(-5px); }
        .footer-contact { margin: 20px 0; }
        .contact-btn {
            display: inline-block; background: var(--gold); color: var(--black);
            padding: 10px 20px; margin: 5px; text-decoration: none;
            border-radius: 20px; font-weight: bold;
        }
        .designer-credit { margin-top: 20px; color: #888; font-size: 0.9rem; }

        /* --- Floating Share Buttons --- */
        .floating-share-buttons {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 995;
        }
        .floating-share-buttons a {
            width: 45px; height: 45px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            color: white; text-decoration: none; font-size: 1.5rem;
            transition: transform 0.3s;
        }
        .floating-share-buttons a:hover { transform: scale(1.1); }
        .share-fb { background: #1877F2; }
        .share-wa { background: #25D366; }
        .share-tg { background: #0088cc; }
        .share-tw { background: #1DA1F2; }

        /* --- Floating Chat Widget --- */
        #chat-widget {
            position: fixed;
            bottom: 20px; right: 20px;
            z-index: 998;
        }
        #chat-icon {
            width: 60px; height: 60px; background: var(--gold);
            color: var(--black); border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 2rem; cursor: pointer;
            box-shadow: 0 0 20px var(--gold);
            animation: pulse 2s infinite;
        }
        #chat-popup {
            position: absolute;
            bottom: 80px; right: 0;
            width: 320px;
            background: var(--dark-gray);
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.5);
            border: 1px solid var(--gold);
            display: none; /* Hidden by default */
            flex-direction: column;
            overflow: hidden;
        }
        .chat-header {
            background: var(--black);
            color: var(--gold);
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }
        .chat-messages {
            height: 300px; padding: 10px;
            overflow-y: auto;
            display: flex; flex-direction: column; gap: 10px;
        }
        .chat-message {
            padding: 8px 12px; border-radius: 10px;
            max-width: 80%;
        }
        .user-message { background: var(--gold); color: var(--black); align-self: flex-end; }
        .bot-message { background: #333; color: var(--light-gold); align-self: flex-start; }
        .chat-input-area {
            display: flex; padding: 10px; border-top: 1px solid var(--gold);
        }
        #chat-input, #name-input {
            flex-grow: 1; border: none; padding: 8px;
            background: var(--black); color: var(--white);
            border-radius: 20px;
        }
        #mic-btn, #send-btn {
            background: none; border: none; color: var(--gold);
            font-size: 1.5rem; cursor: pointer; margin: 0 5px;
        }
        #name-prompt { padding: 15px; text-align: center; }

        @keyframes pulse {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
        }
        
        @media (max-width: 768px) {
            .nav-buttons { gap: 2px; }
            .nav-btn { padding: 6px 8px; font-size: 0.8rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.8rem; }
            .floating-share-buttons { left: 10px; }
            #chat-widget { right: 10px; }
            #chat-popup { width: calc(100vw - 20px); }
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="nav-buttons">
            <a href="index.html" class="nav-btn">الرئيسية</a>
            <a href="men.html" class="nav-btn">عطور رجالي</a>
            <a href="female.html" class="nav-btn">عطور نسائي</a>
            <a href="makeup.html" class="nav-btn">مستحضرات</a>
        </div>
    </div>
                    <!-- أيقونات Font Awesome -->
    <main>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<!-- خط عربي أنيق -->
<link href="https://fonts.googleapis.com/css?family=Cairo&display=swap" rel="stylesheet">
  <meta http-equiv="CONTENT-TYPE" content="text/html; charset=UTF-8">
  <title>Hello, World!</title>
<!-- (4/8) مربع الصور المتحركة وصور المنتجات المصغرة -->
<div class="products-section" style="padding:0px 0;">
  <div id="mainSlider" style="width:100%;max-width:100%;margin:0 auto 5px;position:relative;border:4px solid var(--gold);border-radius:10px;overflow:hidden;background:var(--black);display:flex;justify-content:center;align-items:center;min-height:100%;">
   <!-- الصورة الكبرى المتغيرة -->
    <img id="mainImg" src="moan.jpg" alt="منتج مختار" style="width:100%;max-width:100%;height:100%;object-fit:contain;transition:.4s;">
    </div>
  <!-- صف الصور المصغرة -->
  </div>
  <div class="thumbs-row" style="display:flex;justify-content:center;gap:12px;margin-bottom:5px;">
    <img class="thumb" src="moan1.jpg" alt="منتج 1" data-high="moan1.png" style="width:60px;height:60px;border:2px solid var(--gold);border-radius:2px;cursor:pointer;object-fit:cover;">
    <img class="thumb" src="moan2.jpg" alt="منتج 2" data-high="moan2.png" style="width:60px;height:60px;border:2px solid var(--gold);border-radius:2px;cursor:pointer;object-fit:cover;">
    <img class="thumb" src="moan3.jpg" alt="منتج 3" data-high="moan3.png" style="width:60px;height:60px;border:2px solid var(--gold);border-radius:2px;cursor:pointer;object-fit:cover;">
    <img class="thumb" src="moan4.jpg" alt="منتج 4" data-high="moan4.png" style="width:60px;height:60px;border:2px solid var(--gold);border-radius:2px;cursor:pointer;object-fit:cover;">
    <img class="thumb" src="moan5.jpg" alt="منتج 5" data-high="moan5.png" style="width:60px;height:60px;border:2px solid var(--gold);border-radius:2px;cursor:pointer;object-fit:cover;">
  </div>
</div>
    <div class="container">
                <h1>بخور وعود فاخرة</h1>
                <p>اكتشف مجموعة من البخور والوعود التي تعكس القوة والأناقة.  رائحة تأسر الحواس.</p>
                
                <button id="downloadBtn">
                    <i class="fab fa-android"></i> تحميل تطبيق الأندرويد
                </button>
                <div id="progressBar"></div>
                <div id="downloadStatus" style="margin-top: 5px; color: var(--light-gold);"></div>
            </div>
        </div>

        <hr style="border-color: var(--gold); opacity: 0.2; margin: 40px 0;">

        <div class="container">
            <h2>لماذا تختار الأيقونة للعطور؟</h2>
            <div class="why-us">
                <div class="feature-item">
                    <div class="icon"><i class="fas fa-gem"></i></div>
                    <h3>جودة أصلية</h3>
                    <p>نضمن لكم منتجات أصلية 100% ومكونات عالية الجودة لتجربة فريدة.</p>
                </div>
                <div class="feature-item">
                    <div class="icon"><i class="fas fa-truck-fast"></i></div>
                    <h3>توصيل سريع</h3>
                    <p>خدمة توصيل سريعة وآمنة إلى جميع المحافظات اليمنية تصلك أينما كنت.</p>
                </div>
                <div class="feature-item">
                    <div class="icon"><i class="fas fa-shield-halved"></i></div>
                    <h3>ضمان الرضا</h3>
                    <p>سياسة إرجاع واستبدال مرنة تضمن رضاك الكامل عن مشترياتك.</p>
                </div>
            </div>
        </div>

        <hr style="border-color: var(--gold); opacity: 0.2; margin: 40px 0;">

        <div class="container">
            <h2>منتجاتنا الرجالية المميزة</h2>
            <div id="products-grid" class="products-grid">
                </div>
        </div>

        <div id="purchaseModal" class="modal">
            <div class="modal-content">
                <h3>تأكيد الطلب</h3>
                <p>المنتج: <strong id="modalProductName"></strong></p>
                <p>الإجمالي: <strong id="modalTotalPrice"></strong></p>
                <hr style="border-color: var(--gold); opacity: 0.2; margin: 20px 0;">
                <input type="text" id="customerNameInput" placeholder="الرجاء إدخال اسمك الكريم" required>
                <button id="confirmPurchaseBtn" class="modal-btn">تأكيد وإرسال عبر ماسنجر</button>
                <button class="modal-btn close">إلغاء</button>
            </div>
        </div>

        <hr style="border-color: var(--gold); opacity: 0.2; margin: 40px 0;">

        <div class="container">
            <div id="comments-section">
                <h2>آراء العملاء</h2>
                <form id="comment-form">
                    <input type="text" id="comment-name" placeholder="اسمك (مطلوب)" required>
                    <textarea id="comment-text" rows="4" placeholder="اكتب تعليقك هنا..." required></textarea>
                    <button type="submit">أضف تعليق</button>
                </form>
                <div id="comments-list">
                    </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <h2>تابعنا على</h2>
            <div class="footer-social">
                <a href="https://facebook.com/alayqwnt.ll.twr" target="_blank" title="فيسبوك"><i class="fab fa-facebook"></i></a>
                <a href="https://www.instagram.com/lyqwn_lltwr" target="_blank" title="انستجرام"><i class="fab fa-instagram"></i></a>
                <a href="#" id="whatsapp-group-link" target="_blank" title="مجموعة واتساب"><i class="fab fa-whatsapp"></i></a>
            </div>
            <div class="footer-contact">
                <h2>تواصل معنا</h2>
                <a href="https://m.me/alayqwnt.ll.twr" target="_blank" class="contact-btn"><i class="fab fa-facebook-messenger"></i> خدمة العملاء</a>
                <a href="https://wa.me/967774662666?text=اطلب%20تصميم%20الان" target="_blank" class="contact-btn"><i class="fab fa-whatsapp"></i> اطلب تصميم الآن</a>
            </div>
            <p class="designer-credit">تم التصميم والتطوير بواسطة: <br> م/ طلال سليمان المقطري</p>
        </div>
    </footer>

    <div class="floating-share-buttons">
        <a href="#" id="share-fb" class="share-fb" title="مشاركة على فيسبوك"><i class="fab fa-facebook-f"></i></a>
        <a href="#" id="share-wa" class="share-wa" title="مشاركة على واتساب"><i class="fab fa-whatsapp"></i></a>
        <a href="#" id="share-tg" class="share-tg" title="مشاركة على تيليجرام"><i class="fab fa-telegram-plane"></i></a>
        <a href="#" id="share-tw" class="share-tw" title="مشاركة على تويتر"><i class="fab fa-twitter"></i></a>
    </div>

    <div id="chat-widget">
        <div id="chat-popup">
            <div class="chat-header">
                <span>مساعد الأيقونة الذكي</span>
                <button id="close-chat" style="background:none; border:none; color:white; float:left; font-size:1.2rem; cursor:pointer;">&times;</button>
            </div>
            <div class="chat-messages" id="chat-messages">
                </div>
            <div id="name-prompt">
                <p>مرحباً بك! الرجاء إدخال اسمك للبدء.</p>
                <input type="text" id="name-input" placeholder="اكتب اسمك هنا...">
                <button id="send-name-btn" class="modal-btn" style="margin-top:10px;">بدء المحادثة</button>
            </div>
            <div class="chat-input-area" id="chat-input-area" style="display:none;">
                <button id="mic-btn" title="تحدث"><i class="fas fa-microphone"></i></button>
                <input type="text" id="chat-input" placeholder="اكتب سؤالك...">
                <button id="send-btn" title="إرسال"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
        <div id="chat-icon">
            <i class="fas fa-comments"></i>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>
    
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
      import { getFirestore, collection, addDoc, getDocs, onSnapshot, doc, updateDoc, increment, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
      
      const firebaseConfig = {
        apiKey: "AIzaSyAcOLUzUULR6HYcJKdPCFvhJJHT4gKnczU",
        authDomain: "icon-for-perfumes-5ccd6.firebaseapp.com",
        projectId: "icon-for-perfumes-5ccd6",
        storageBucket: "icon-for-perfumes-5ccd6.appspot.com",
        messagingSenderId: "942406140856",
        appId: "1:942406140856:web:ff4729e3f3a7653a56454d"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      window.firebase = { db, collection, addDoc, getDocs, onSnapshot, doc, updateDoc, increment, serverTimestamp };
    </script>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Service Worker Registration for PWA ---
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(registration => console.log('Service Worker registered successfully:', registration))
                .catch(error => console.log('Service Worker registration failed:', error));
        }
        
        // --- App Download Simulation ---
        const downloadBtn = document.getElementById('downloadBtn');
        const progressBar = document.getElementById('progressBar');
        const downloadStatus = document.getElementById('downloadStatus');
        let downloading = false;
        downloadBtn.onclick = () => {
            if (downloading) return;
            downloading = true;
            downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري التحميل...';
            downloadBtn.disabled = true;
            progressBar.style.width = '0%';
            downloadStatus.innerText = '';
            let percent = 0;
            const totalKb = 9850;
            const interval = setInterval(() => {
                percent += 2;
                if (percent >= 100) {
                    clearInterval(interval);
                    percent = 100;
                    downloadBtn.innerHTML = '<i class="fas fa-download"></i> تثبيت تطبيق الأندرويد';
                    downloadStatus.innerText = 'اكتمل التحميل ✔️';
                    downloadBtn.disabled = false;
                    downloadBtn.onclick = () => { window.open('الأيقونة.apk', '_blank'); };
                }
                progressBar.style.width = percent + '%';
                let kb = Math.floor((percent/100)*totalKb);
                downloadStatus.innerText = `${kb} / ${totalKb} كيلو بايت`;
            }, 50);
        };

        // --- Product Data ---
        const products = [
            { id: 'p1', name: 'بخور العود الملكي', price: 5900, image: 'moan1.jpg', rating: 4.8 },
            { id: 'p2', name: 'بخور نسيم البحر', price: 4900, image: 'moan2.jpg', rating: 4.5 },
            { id: 'p3', name: 'بخور روح الصحراء', price: 5500, image: 'moan3.jpg', rating: 4.9 },
            { id: 'p4', name: 'بخور ليالي الشرق', price: 5200, image: 'moan4.jpg', rating: 4.7 },
            { id: 'p5', name: 'بخور خرير الماء', price: 4200, image: 'moan5.jpg', rating: 4.6 }
        ];

        const productsGrid = document.getElementById('products-grid');
        products.forEach(product => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <img src="${product.image}" alt="${product.name}">
                <h3>${product.name}</h3>
                <div class="product-info">
                    <div class="rateYo" data-rateyo-rating="${product.rating}" data-rateyo-read-only="true"></div>
                    <button class="like-btn" data-product-id="${product.id}"><i class="far fa-heart"></i> <span id="like-count-${product.id}">0</span></button>
                </div>
                <div class="price">
                    <span>${product.price.toLocaleString()} ريال</span>
                </div>
                <div class="quantity-selector">
                    <button class="quantity-minus">-</button>
                    <input type="number" class="quantity-input" value="1" min="1" readonly>
                    <button class="quantity-plus">+</button>
                </div>
                <div class="total-price">الإجمالي: <span class="total-price-value">${product.price.toLocaleString()}</span> ريال</div>
                <button class="buy-btn" data-product-name="${product.name}" data-product-price="${product.price}">شراء الآن</button>
                <div class="social-share">
                    <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}" target="_blank" class="facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(product.name)}" target="_blank" class="twitter"><i class="fab fa-twitter"></i></a>
                    <a href="https://api.whatsapp.com/send?text=${encodeURIComponent(product.name + ' ' + window.location.href)}" target="_blank" class="whatsapp"><i class="fab fa-whatsapp"></i></a>
                    <a href="https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(product.name)}" target="_blank" class="telegram"><i class="fab fa-telegram-plane"></i></a>
                </div>
            `;
            productsGrid.appendChild(card);
        });
        
        // Initialize RateYo
        $(".rateYo").rateYo({
            rating: function () { return $(this).attr('data-rateyo-rating'); },
            starWidth: "20px",
            ratedFill: "var(--gold)",
            normalFill: "#555",
            readOnly: function () { return $(this).attr('data-rateyo-read-only') === 'true'; },
            rtl: true,
            spacing: "5px"
        });

        // --- Product Card Interactivity ---
        productsGrid.addEventListener('click', e => {
            const quantityInput = e.target.closest('.product-card')?.querySelector('.quantity-input');
            const price = parseFloat(e.target.closest('.product-card')?.querySelector('.buy-btn').dataset.productPrice);
            const totalPriceEl = e.target.closest('.product-card')?.querySelector('.total-price-value');
            
            if (e.target.classList.contains('quantity-plus')) {
                quantityInput.value = parseInt(quantityInput.value) + 1;
            }
            if (e.target.classList.contains('quantity-minus') && quantityInput.value > 1) {
                quantityInput.value = parseInt(quantityInput.value) - 1;
            }
            if (quantityInput) {
                const total = parseInt(quantityInput.value) * price;
                totalPriceEl.textContent = total.toLocaleString();
            }

            // Buy Now Button
            if (e.target.classList.contains('buy-btn')) {
                const productName = e.target.dataset.productName;
                const total = totalPriceEl.textContent;
                openPurchaseModal(productName, total, parseInt(quantityInput.value));
            }
            
            // Like Button
            if (e.target.closest('.like-btn')) {
                handleLike(e.target.closest('.like-btn'));
            }
        });
        
        // --- Purchase Modal Logic ---
        const modal = document.getElementById('purchaseModal');
        const modalProductName = document.getElementById('modalProductName');
        const modalTotalPrice = document.getElementById('modalTotalPrice');
        const confirmBtn = document.getElementById('confirmPurchaseBtn');
        let currentProduct = {};

        function openPurchaseModal(name, total, quantity) {
            currentProduct = { name, total, quantity };
            modalProductName.textContent = name;
            modalTotalPrice.textContent = total + ' ريال';
            modal.style.display = 'flex';
        }

        modal.querySelector('.close').onclick = () => modal.style.display = 'none';
        window.onclick = e => { if (e.target == modal) modal.style.display = 'none'; };

        confirmBtn.onclick = () => {
            const customerName = document.getElementById('customerNameInput').value.trim();
            if (!customerName) {
                alert('الرجاء إدخال اسمك لإتمام الطلب.');
                return;
            }
            const message = `مرحباً مبيعات الأيقونة للعطور،\nأنا ${customerName}، وأرغب في طلب المنتج التالي:\n\nالمنتج: ${currentProduct.name}\nالكمية: ${currentProduct.quantity}\nالسعر الإجمالي: ${currentProduct.total} ريال\n\nالرابط المرجعي: ${window.location.href}\n\nشكراً لكم.`;
            const messengerLink = `https://m.me/alayqwnt.ll.twr?text=${encodeURIComponent(message)}`;
            window.open(messengerLink, '_blank');
            modal.style.display = 'none';
        };

        // --- Firebase Firestore Logic (Likes & Comments) ---
        const { db, collection, addDoc, onSnapshot, doc, updateDoc, increment, serverTimestamp } = window.firebase;
        const commentsCollection = collection(db, 'mens-perfume-comments');
        const likesCollection = collection(db, 'product-likes');

        // Handle Likes
        async function handleLike(btn) {
            const productId = btn.dataset.productId;
            const likedKey = `liked_${productId}`;
            
            if (localStorage.getItem(likedKey)) {
                // Unlike (optional, can be implemented)
                console.log("Already liked");
                return;
            }

            const likeDocRef = doc(db, "product-likes", productId);
            await updateDoc(likeDocRef, { count: increment(1) });
            
            localStorage.setItem(likedKey, 'true');
            btn.classList.add('liked');
            btn.querySelector('i').className = 'fas fa-heart';
        }

        // Fetch and display likes
        products.forEach(p => {
            const likeDocRef = doc(db, "product-likes", p.id);
            onSnapshot(likeDocRef, (doc) => {
                const count = doc.exists() ? doc.data().count : 0;
                document.getElementById(`like-count-${p.id}`).textContent = count;
            });
        });


        // Handle Comments
        const commentForm = document.getElementById('comment-form');
        const commentsList = document.getElementById('comments-list');

        commentForm.addEventListener('submit', async e => {
            e.preventDefault();
            const name = document.getElementById('comment-name').value;
            const text = document.getElementById('comment-text').value;
            
            await addDoc(commentsCollection, {
                name: name,
                text: text,
                createdAt: serverTimestamp()
            });

            commentForm.reset();
        });

        // Listen for and display comments
        onSnapshot(commentsCollection, (snapshot) => {
            commentsList.innerHTML = '';
            snapshot.docs.sort((a, b) => b.data().createdAt - a.data().createdAt).forEach(doc => {
                const comment = doc.data();
                const date = comment.createdAt ? comment.createdAt.toDate().toLocaleString('ar-SA') : 'الآن';
                const div = document.createElement('div');
                div.className = 'comment';
                div.innerHTML = `
                    <div class="comment-header">
                        <span class="comment-author">${comment.name}</span>
                        <span class="comment-date">${date}</span>
                    </div>
                    <p class="comment-text">${comment.text}</p>
                `;
                commentsList.appendChild(div);
            });
        });
        
        // --- Floating Share Buttons Logic ---
        const shareText = `الأيقونة للعطور - جودة وأصالة\nعطور رجالية ونسائية وبخور ومستحضرات التجميل.\nيوجد لدينا توصيل الى جميع المحافظات اليمنيه.\n\nاكتشف قسم بخور وعود:\n${window.location.href}`;
        document.getElementById('share-fb').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(shareText)}`;
        document.getElementById('share-wa').href = `https://api.whatsapp.com/send?text=${encodeURIComponent(shareText)}`;
        document.getElementById('share-tg').href = `https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(shareText)}`;
        document.getElementById('share-tw').href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(shareText)}`;

        // --- Chat Widget Logic ---
        const chatIcon = document.getElementById('chat-icon');
        const chatPopup = document.getElementById('chat-popup');
        const closeChatBtn = document.getElementById('close-chat');
        const chatMessages = document.getElementById('chat-messages');
        const namePrompt = document.getElementById('name-prompt');
        const nameInput = document.getElementById('name-input');
        const sendNameBtn = document.getElementById('send-name-btn');
        const chatInputArea = document.getElementById('chat-input-area');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const micBtn = document.getElementById('mic-btn');
        const GEMINI_API_KEY = 'AIzaSyDSGuS0cRduU1dPGzHjXRjWvjDgzL4NyIY';
        const audioPlayer = new Audio();
        let userName = localStorage.getItem('perfume_userName');

        // Text-to-Speech function
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ar-SA';
                window.speechSynthesis.speak(utterance);
            }
        }
        
        async function handleMessageSend() {
          const input = document.getElementById('chatInput');
          const message = input.value.trim();
          if (message) {
              addMessageToChat(message, 'user');
              input.value = '';
              await processMessage(message);
          }
      }

        // Add message to chat UI
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        // Open/Close chat
        chatIcon.onclick = () => { chatPopup.style.display = 'flex'; chatIcon.style.display = 'none'; };
        closeChatBtn.onclick = () => { chatPopup.style.display = 'none'; chatIcon.style.display = 'block'; };

        // Handle user name
        if (userName) {
            namePrompt.style.display = 'none';
            chatInputArea.style.display = 'flex';
            const welcomeBackMsg = `أهلاً بعودتك يا ${userName}! كيف أقدر أساعدك اليوم؟ يمكنك سماع الموسيقى اكتب "شغل موسيقى".`;
            addMessage(welcomeBackMsg, 'bot');
            speak(welcomeBackMsg);
        } else {
            const welcomeMsg = "أهلاً بك في متجر الأيقونة! أنا خدمة العملاء. لطفاً، أدخل اسمك للبدء.";
            addMessage(welcomeMsg, 'bot');
            speak(welcomeMsg);
        }

        sendNameBtn.onclick = () => {
            const name = nameInput.value.trim();
            if (name) {
                userName = name;
                localStorage.setItem('perfume_userName', userName);
                namePrompt.style.display = 'none';
                chatInputArea.style.display = 'flex';
                addMessage(`رائع يا ${userName}! كيف أقدر أساعدك؟ لسماع الموسيقى ارسل كلمة "تشغيل`, 'bot');
            }
        };

        // Handle sending messages
        sendBtn.onclick = handleUserInput;
        chatInput.onkeypress = e => { if (e.key === 'Enter') handleUserInput(); };
        
        function handleUserInput() {
            const query = chatInput.value.trim();
            if (!query) return;
            addMessage(query, 'user');
            processQuery(query);
            chatInput.value = '';
        }
        
        // Music Commands
        const playCommands = ['تشغيل', 'شغل', 'موسيقى', 'طرب', 'اغاني', 'غني'];
        const stopCommands = ['ايقاف', 'إيقاف', 'اغلاق', 'إغلاق', 'طفي', 'صمت'];

        // Pre-defined Answers
        const preDefinedAnswers = {
            'دفع': 'نقدم عدة طرق للدفع: إيداع بنك الكريمي، حوالات مصرفية، أو عبر المحافظ الإلكترونية.',
            'توصيل': 'مدة التوصيل تتراوح بين 1-3 أيام في المدن الكبرى و3-7 أيام لباقي المناطق.',
            'جودة': 'جميع منتجاتنا أصلية 100% وذات جودة عالية مع ضمان استرجاع.',
            'عروض': 'لدينا عروض دورية. تابع صفحاتنا على التواصل الاجتماعي لمعرفة أحدث العروض.',
            'سعر': 'الأسعار موضحة في صفحة كل منتج. لأي استفسار آخر، أنا في الخدمة.',
            'استبدال': 'نقدم خدمة استبدال المنتج خلال 7 أيام من الاستلام في حال وجود عيب مصنعي.',
            'عنوان': 'مقرنا الرئيسي في محافظة ذمار، اليمن، ونقوم بالتوصيل لجميع المحافظات.',
            'مصمم': 'تم تصميم المتجر بواسطة المبرمج والمصمم طلال سليمان المقطري. للتواصل معه: 774662666.',
            'من معي': 'انا موظف خدمة العملاء لدى متجر الأيقونة للعطور..',
            'من انت': 'انا موظف خدمة العملاء لدى متجر الأيقونة للعطور.'
        };

        // Process user query
        async function processQuery(query) {
            // Check for music commands
            if (playCommands.some(cmd => query.includes(cmd))) {
                audioPlayer.src = 'http://stream.zeno.fm/ae32e025wp8uv';
                audioPlayer.play();
                addMessage('  تم تشغيل الموسيقى لك 🎶 للإيقاف ارسل كلمة "ايقاف"', 'bot');
                return;
            }
            if (stopCommands.some(cmd => query.includes(cmd))) {
                audioPlayer.pause();
                audioPlayer.src = '';
                addMessage('تم إيقاف الموسيقى لتشغيل ارسل كلمة "تشغيل".', 'bot');
                return;
            }

            // Check for pre-defined answers
            for (const key in preDefinedAnswers) {
                if (query.includes(key)) {
                    addMessage(preDefinedAnswers[key], 'bot');
                    speak(preDefinedAnswers[key]);
                    return;
                }
            }

            // Fallback to Gemini API
            addMessage('لحظات، الأيقونة يكتب الإجابة... 🤔 الأن', 'bot');
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        "contents": [{
                            "parts": [{ "text": `أنت خدمة العملاء في متجر عطور اسمه "الأيقونة". عنوان: المركز الرئيسي للأيقونة "اليمن محافظة ذمار". عملية شراء منتج يتم الدفع عبر إيداع مبلغ الشراء لحساب الايقونة لدى بنك الكريمي. رقم حساب الكريمي الخاص باستقبال المبالغ قم بمراسلتنا عبر زر الماسنجر الموجود في اسفل صفحة المتجر او الضغط على زر اطلب الان الموجود تحت كل منتج ليتم تزويدك برقم حساب بنك الكريمي. مصمم ومبرمح متحر الأيقونة "السيد طلال سليمان المقطري". رقم هاتف المصمم طلال سليمان المقطري "774662666". أجب على السؤال التالي باللغة العربية بأسلوب ودود ومختصر: ${message}` }]
                        }]
                    })
                });
                const data = await response.json();
                const botResponse = data.candidates[0].content.parts[0].text;
                
                // Remove the "thinking" message and add the real one
                chatMessages.removeChild(chatMessages.lastChild); 
                addMessage(botResponse, 'bot');
                speak(botResponse);

            } catch (error) {
                console.error("Gemini API Error:", error);
                chatMessages.removeChild(chatMessages.lastChild); 
                addMessage('عذراً، حدث خطأ أثناء محاولة الرد. مؤظف خدمة العملاء غير متواجد في الوقت الحالي. يرجى المحاولة مرة أخرى..', 'bot');
            }
        }
        
        // Speech Recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'ar-SA';
            recognition.continuous = false;
            
            micBtn.onclick = () => {
                recognition.start();
                micBtn.style.color = '#ff6b6b';
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                chatInput.value = transcript;
                handleUserInput();
            };

            recognition.onend = () => {
                micBtn.style.color = 'var(--gold)';
            };
        } else {
            micBtn.style.display = 'none';
        }

    });

const sliderImgs = ["moan1.jpg","moan2.jpg","moan3.jpg","moan4.jpg","moan5.jpg"];
  const highImgs = ["moan1.png","moan2.png","moan3.png","moan4.png","moan5.png"];
  let mainImg = document.getElementById('mainImg');
  let thumbs = document.querySelectorAll('.thumb');
  let sliderIndex = 0;
  let sliderActive = true;
  let sliderInterval = setInterval(()=>{
    if (sliderActive) {
      sliderIndex = (sliderIndex+1)%sliderImgs.length;
      mainImg.src = sliderImgs[sliderIndex];
    }
  }, 1800);

  thumbs.forEach((thumb,idx)=>{
    thumb.onclick = ()=>{
      sliderActive = false;
      clearInterval(sliderInterval);
      mainImg.src = highImgs[idx];
      // ظل للصورة المختارة
      thumbs.forEach(t=>t.style.boxShadow="none");
      thumb.style.boxShadow="0 0 12px var(--gold)";
    };
  });
  // إعادة التشغيل عند مغادرة الماوس المربع الكبير
  mainImg.onmouseleave = ()=>{
    if(!sliderActive){
      sliderActive = true;
      sliderInterval = setInterval(()=>{
        sliderIndex = (sliderIndex+1)%sliderImgs.length;
        mainImg.src = sliderImgs[sliderIndex];
        thumbs.forEach(t=>t.style.boxShadow="none");
      }, 1800);
    }
  };
  
  $('.rateYo').each(function(){
    $(this).rateYo({
      rtl:true,
      rating: $(this).data('rate'),
      starWidth: "18px",
      ratedFill: "#D4AF37",
      normalFill: "#fff2b2",
      readOnly: true,
      spacing:"3px"
    });
  });
    </script>

</body>
</html>
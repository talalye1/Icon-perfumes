<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="الأيقونة للعطور - قسم العطور الرجالية">
    <meta property="og:description" content="اكتشف مجموعة من العطور الرجالية التي تعكس القوة والأناقة. ثبات يدوم طويلاً ورائحة تأسر الحواس.">
    <meta property="og:image" content="https://talalye1.github.io/Icon-perfumes/men.jpg">
    <meta property="og:url" content="https://talalye1.github.io/Icon-perfumes/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="الأيقونة للعطور - قسم العطور الجالية">
    <title>الأيقونة للعطور - قسم العطور الرجالية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="icon.png" type="image/png">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --light-gold: #F5DEB3;
            --black: #0F0F0F;
            --dark-gray: #1A1A1A;
            --white: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--black);
            color: var(--white);
            position: relative;
            background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), 
                              url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><defs><pattern id="d" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M0 10h20M10 0v20" stroke-width="0.3" stroke="%23D4AF37"/></pattern></defs><rect width="100%" height="100%" fill="url(%23d)"/></svg>');
            background-size: 200px;
            overflow-x: hidden;
        }

        body::before {
            content: "";
            position: fixed;
            top: 5px; left: 5px; right: 5px; bottom: 5px;
            border: 1px solid var(--gold);
            pointer-events: none;
            z-index: 1000;
            border-radius: 10px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1, h2, h3 { color: var(--gold); }
        h2 { text-align: center; margin-bottom: 25px; font-size: 2.2rem; }

        /* --- Navigation Bar --- */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            background: rgba(15, 15, 15, 0.8);
            backdrop-filter: blur(10px);
            padding: 10px 0;
            border-bottom: 2px solid var(--gold);
            z-index: 990;
        }
        .nav-buttons { display: flex; gap: 5px; }
        .nav-btn {
            color: var(--gold);
            background: var(--black);
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: bold;
            border: 1px solid var(--gold);
            transition: all 0.3s ease;
        }
        .nav-btn:hover, .nav-btn.active {
            background: var(--gold);
            color: var(--black);
            box-shadow: 0 0 15px var(--gold);
        }
        
        main { padding-top: 80px; /* Space for fixed nav */ }

    /* --- Navigation Bar2 --- */
        .top-bar2 {
            position: fixed;
            bottom: 540px;
            left: 0px;
            width: 100%;
            display: flex;
            justify-content: center;
            backdrop-filter: blur(5px);
            padding: 0px 0;
            gap: 0px;
            z-index: 1000;
        }
        .nav-btn:hover, .nav-btn.active {
            background: var(--gold);
            color: var(--black);
            box-shadow: 0 0 0px var(--gold);
        }
    
        /* --- Header Section --- */
        .header-content { text-align: center; margin-top: 20px; }
        .header-content .logo img {
            width: 100%;
            max-width: 600px;
            height: auto;
            border-radius: 15px;
            border: 3px solid var(--gold);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
        }
        .header-content h1 { margin: 20px 0 10px; font-size: 2.5rem; }
        .header-content p { color: var(--light-gold); margin-bottom: 20px; font-size: 1.1rem; }

        /* --- Download Button --- */
        #downloadBtn {
            background: var(--gold); color: var(--black); font-size: 1.1rem;
            border: none; padding: 12px 24px; border-radius: 8px;
            width: 100%; max-width: 400px; cursor: pointer; font-weight: bold;
            transition: all 0.3s;
        }
        #downloadBtn:hover { transform: scale(1.05); }
        #progressBar { height: 6px; width: 0; background: var(--gold); margin: 8px auto 0; transition: width 0.3s; max-width: 400px; border-radius: 6px; }

        /* --- Why Us & Visitor Counter Section --- */
        .stats-section {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 40px;
            background: var(--dark-gray);
            padding: 20px;
            border-radius: 15px;
        }
        .feature-item { text-align: center; max-width: 200px; }
        .feature-item .icon { font-size: 2.5rem; color: var(--gold); margin-bottom: 10px; }
        .feature-item h3 { font-size: 1.3rem; margin-bottom: 5px; }
        .feature-item p { color: var(--light-gold); font-size: 0.95rem; }
        #visitor-counter-container { text-align: center; }
        #visitor-counter { font-size: 2.5rem; font-weight: bold; color: var(--gold); }
        
        /* --- Search Bar --- */
        .search-container {
            margin: 30px auto;
            max-width: 600px;
            position: relative;
        }
        #search-bar {
            width: 100%;
            padding: 15px 50px 15px 20px;
            background: var(--dark-gray);
            border: 2px solid var(--gold);
            border-radius: 30px;
            color: var(--white);
            font-size: 1.1rem;
        }
        .search-container .fa-search {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            color: var(--gold);
        }

        /* --- Products Section --- */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }
        .product-card {
            background: var(--dark-gray);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .product-card:hover { border-color: var(--gold); box-shadow: 0 0 20px rgba(212, 175, 55, 0.4); }
        .product-card img { width: 100%; height: 200px; object-fit: cover; border-radius: 10px; cursor: pointer; margin-bottom: 15px; }
        .product-card h3 { font-size: 1.4rem; color: var(--light-gold); }
        .product-info { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
        .price { font-size: 1.3rem; font-weight: bold; color: var(--gold); }
        .like-btn { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }
        .like-btn.liked { color: #ff6b6b; }
        .quantity-selector { display: flex; align-items: center; justify-content: center; gap: 10px; margin: 15px 0; }
        .quantity-selector button { background: var(--gold); color: var(--black); border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; }
        .quantity-selector input { width: 50px; text-align: center; background: var(--black); color: var(--white); border: 1px solid var(--gold); border-radius: 5px; padding: 5px; }
        .total-price { margin: 10px 0; font-weight: bold; }
        .buy-btn {
            background: var(--gold); color: var(--black); font-size: 1.1rem;
            border: none; padding: 10px 20px; border-radius: 8px; width: 100%;
            cursor: pointer; font-weight: bold; margin-top: 10px; transition: all 0.3s;
        }
        .buy-btn:hover { background: var(--light-gold); }
        .social-share { margin-top: 15px; }
        .social-share a { color: white; margin: 0 8px; font-size: 1.5rem; text-decoration: none; }
        .social-share a.facebook:hover { color: #1877F2; }
        .social-share a.twitter:hover { color: #1DA1F2; }
        .social-share a.whatsapp:hover { color: #25D366; }
        .social-share a.telegram:hover { color: #0088cc; }

        /* --- Modal (Popup) --- */
        .modal {
            position: fixed; z-index: 1001; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.7);
            display: none; justify-content: center; align-items: center;
        }
        .modal-content {
            background: var(--dark-gray);
            padding: 30px; border-radius: 15px;
            border: 2px solid var(--gold);
            width: 90%; max-width: 450px;
            text-align: center;
        }
        .modal-content h3 { margin-bottom: 20px; }
        .modal-content input {
            width: 100%; padding: 12px; margin-bottom: 20px;
            border-radius: 8px; border: 1px solid var(--gold);
            background: var(--black); color: var(--white); font-size: 1rem;
        }
        .modal-btn {
            background: var(--gold); color: var(--black); font-size: 1.1rem;
            border: none; padding: 12px 24px; border-radius: 8px;
            cursor: pointer; font-weight: bold; margin: 5px;
        }
        .modal-btn.close { background: #555; color: white; }
        
        /* --- Comments Section --- CODE MODIFIED */
        #comments-section { background: var(--dark-gray); padding: 20px; border-radius: 15px; margin-top: 40px; }
        #comment-form { display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px; }
        #comment-form input, #comment-form textarea {
            padding: 10px; background: var(--black); color: var(--white);
            border: 1px solid var(--gold); border-radius: 8px;
        }
        #comment-form button {
            align-self: flex-start; background: var(--gold); color: var(--black);
            padding: 10px 20px; border-radius: 8px; font-weight: bold; border: none; cursor: pointer;
        }
        .comment { border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 15px; }
        .comment-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .comment-author { font-weight: bold; color: var(--gold); }
        .comment-date { font-size: 0.8rem; color: #aaa; }
        .comment-text { color: var(--light-gold); line-height: 1.6; }
        .comment-actions { display: flex; gap: 15px; font-size: 0.9rem; color: #ccc; margin-top: 10px; }
        .comment-actions button { background: none; border: none; color: #ccc; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .comment-actions button:hover { color: var(--gold); }
        .comment-actions .action-like.liked { color: #ff6b6b; }
        .replies-container { margin-top: 15px; margin-right: 30px; border-right: 2px solid var(--gold); padding-right: 15px; }
        .reply { margin-bottom: 10px; }
        .reply-form { display: none; margin-top: 10px; }

        /* --- Footer --- */
        footer { text-align: center; padding: 30px 20px; margin-top: 40px; background: var(--dark-gray); }
        .footer-social a { color: var(--gold); margin: 0 15px; font-size: 2rem; transition: all 0.3s; }
        .footer-social a:hover { color: var(--light-gold); transform: translateY(-5px); }
        .footer-contact { margin: 20px 0; }
        .contact-btn {
            display: inline-block; background: var(--gold); color: var(--black);
            padding: 10px 20px; margin: 5px; text-decoration: none;
            border-radius: 20px; font-weight: bold;
        }
        .designer-credit { margin-top: 20px; color: #888; font-size: 0.9rem; }

        /* --- Floating Share Buttons --- */
        .floating-share-buttons {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 995;
        }
        .floating-share-buttons a {
            width: 45px; height: 45px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            color: white; text-decoration: none; font-size: 1.5rem;
            transition: transform 0.3s;
        }
        .floating-share-buttons a:hover { transform: scale(1.1); }
        .share-fb { background: #1877F2; }
        .share-wa { background: #25D366; }
        .share-tg { background: #0088cc; }
        .share-tw { background: #1DA1F2; }

        /* --- Floating Chat Widget --- */
        #chat-widget {
            position: fixed;
            bottom: 20px; right: 20px;
            z-index: 998;
        }
        #chat-icon {
            width: 60px; height: 60px; background: var(--gold);
            color: var(--black); border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 2rem; cursor: pointer;
            box-shadow: 0 0 20px var(--gold);
            animation: pulse 2s infinite;
        }
        #chat-popup {
            position: absolute;
            bottom: 80px; right: 0;
            width: 320px;
            background: var(--dark-gray);
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.5);
            border: 1px solid var(--gold);
            display: none; /* Hidden by default */
            flex-direction: column;
            overflow: hidden;
        }
        .chat-header {
            background: var(--black);
            color: var(--gold);
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }
        .chat-messages {
            height: 300px; padding: 10px;
            overflow-y: auto;
            display: flex; flex-direction: column; gap: 10px;
        }
        .chat-message {
            padding: 8px 12px; border-radius: 10px;
            max-width: 80%;
        }
        .user-message { background: var(--gold); color: var(--black); align-self: flex-end; }
        .bot-message { background: #333; color: var(--light-gold); align-self: flex-start; }
        .chat-input-area {
            display: flex; padding: 10px; border-top: 1px solid var(--gold);
        }
        #chat-input, #name-input {
            flex-grow: 1; border: none; padding: 8px;
            background: var(--black); color: var(--white);
            border-radius: 20px;
        }
        #mic-btn, #send-btn {
            background: none; border: none; color: var(--gold);
            font-size: 1.5rem; cursor: pointer; margin: 0 5px;
        }
        #name-prompt { padding: 15px; text-align: center; }

        @keyframes pulse {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
        }
        
        @media (max-width: 768px) {
            .nav-buttons { gap: 2px; }
            .nav-btn { padding: 6px 8px; font-size: 0.8rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.8rem; }
            .floating-share-buttons { left: 10px; }
            #chat-widget { right: 10px; }
            #chat-popup { width: calc(100vw - 20px); }
        }
    </style>
</head>
<body>
    <div id="visitor-counter-container">
        <main>
        <div class="container">
    <div class="top-bar2">
<div class="nav-btn2"> <h1>قسم العطور الرجالية</h1>
               </div>
    </div>
    <div class="top-bar">
        <div class="nav-buttons">
            <a href="index.html" class="nav-btn">الرئيسية</a>
            <a href="index.html" class="nav-btn active">الرجالية</a>
            <a href="female.html" class="nav-btn">النسائية</a>
            <a href="moan.html" class="nav-btn">بخـور وعود</a>
            <a href="makeup.html" class="nav-btn">مستحضرات</a>
        </div>
                 </div>
    
    <main>
        <div class="container">
            <div class="header-content">
                <div class="logo">
<!-- (4/8) مربع الصور المتحركة وصور المنتجات المصغرة -->
                
         <div class="products-section" style="padding:0px 0;">
  <div id="mainSlider" style="width:100%;max-width:100%;margin:0 auto 5px;position:relative;border:4px solid var(--gold);border-radius:10px;overflow:hidden;background:var(--black);display:flex;justify-content:center;align-items:center;min-height:100%;">
   <!-- الصورة الكبرى المتغيرة -->
    <img id="mainImg" src="men.jpg" alt="منتج مختار" style="width:100%;max-width:100%;height:100%;object-fit:contain;transition:.4s;">
    </div>
  <!-- صف الصور المصغرة -->
  </div>
<div class="container">
  <div class="thumbs-row" style="display:flex;justify-content:center;gap:12px;margin-bottom:5px;">
    <img class="thumb" src="men1.jpg" alt="منتج 1" data-high="men1.png" style="width:60px;height:60px;border:2px solid var(--gold);border-radius:2px;cursor:pointer;object-fit:cover;">
    <img class="thumb" src="men2.jpg" alt="منتج 2" data-high="men2.png" style="width:60px;height:60px;border:2px solid var(--gold);border-radius:2px;cursor:pointer;object-fit:cover;">
    <img class="thumb" src="men3.jpg" alt="منتج 3" data-high="men3.png" style="width:60px;height:60px;border:2px solid var(--gold);border-radius:2px;cursor:pointer;object-fit:cover;">
    <img class="thumb" src="men4.jpg" alt="منتج 4" data-high="men4.png" style="width:60px;height:60px;border:2px solid var(--gold);border-radius:2px;cursor:pointer;object-fit:cover;">
    <img class="thumb" src="men5.jpg" alt="منتج 5" data-high="men5.png" style="width:60px;height:60px;border:2px solid var(--gold);border-radius:2px;cursor:pointer;object-fit:cover;">
  </div>
                <div id="visitor-counter-container">
                    <h3>عدد زوار الصفحة</h3>
                    <div id="visitor-counter">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                <h1>عطور رجالية فاخرة</h1>
                <p>اكتشف مجموعة العطور الرجالية التي تعكس القوة والأناقة. ثبات يدوم طويلاً ورائحة تأسر الحواس.</p>
                
                <button id="downloadBtn">
                    <i class="fab fa-android"></i> تحميل تطبيق الأندرويد
                </button>
                <div id="progressBar"></div>
                <div id="downloadStatus" style="margin-top: 5px; color: var(--light-gold);"></div>
            </div>
        </div>
        <div class="container">
            <h2>لماذا تختار الأيقونة للعطور؟</h2>
            <div class="why-us">
            <div class="stats-section">
                <div class="feature-item">
                    <div class="icon"><i class="fas fa-gem"></i></div>
                    <h3>جودة أصلية</h3>
                </div>
                <div class="feature-item">
                    <div class="icon"><i class="fas fa-truck-fast"></i></div>
                    <h3>توصيل سريع</h3>
                
                </div>
                <div class="feature-item">
                    <div class="icon"><i class="fas fa-shield-halved"></i></div>
                    <h3>ضمان الرضا</h3>
                </div>
            </div>
        </div>
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="search" id="search-bar" placeholder="ابحث عن عطرك المفضل...">
            </div>
        </div>
        <div class="container">
            <h2>منتجاتنا الرجالية المميزة</h2>
            
            <div id="products-grid" class="products-grid">
                </div>
        </div>

        <div id="purchaseModal" class="modal">
            <div class="modal-content">
                <h3>تأكيد الطلب</h3>
                <p>المنتج: <strong id="modalProductName"></strong></p>
                <p>الإجمالي: <strong id="modalTotalPrice"></strong></p>
                <hr style="border-color: var(--gold); opacity: 0.2; margin: 20px 0;">
                <input type="text" id="customerNameInput" placeholder="الرجاء إدخال اسمك الكريم" required>
                <button id="confirmPurchaseBtn" class="modal-btn">تأكيد وإرسال عبر ماسنجر</button>
                <button class="modal-btn close">إلغاء</button>
            </div>
        </div>

        <hr style="border-color: var(--gold); opacity: 0.2; margin: 40px 0;">

        <div class="container">
            <div id="comments-section">
                <h2>آراء العملاء</h2>
                <form id="comment-form">
                    <input type="text" id="comment-name" placeholder="اسمك (مطلوب)" required>
                    <textarea id="comment-text" rows="4" placeholder="اكتب تعليقك هنا..." required></textarea>
                    <button type="submit">أضف تعليق</button>
                </form>
                <div id="comments-list">
                    <p>جاري تحميل التعليقات...</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <h2>تابعنا على</h2>
            <div class="footer-social">
                <a href="https://facebook.com/alayqwnt.ll.twr" target="_blank" title="فيسبوك"><i class="fab fa-facebook"></i></a>
                <a href="https://www.instagram.com/lyqwn_lltwr" target="_blank" title="انستجرام"><i class="fab fa-instagram"></i></a>
                <a href="#" id="whatsapp-group-link" target="_blank" title="مجموعة واتساب"><i class="fab fa-whatsapp"></i></a>
            </div>
            <div class="footer-contact">
                <h2>تواصل معنا</h2>
                <a href="https://m.me/alayqwnt.ll.twr" target="_blank" class="contact-btn"><i class="fab fa-facebook-messenger"></i> خدمة العملاء</a>
                <a href="https://wa.me/967774662666?text=اطلب%20تصميم%20الان" target="_blank" class="contact-btn"><i class="fab fa-whatsapp"></i> اطلب تصميم الآن</a>
            </div>
            <p class="designer-credit">تم التصميم والتطوير بواسطة: <br> م/ طلال سليمان المقطري</p>
        </div>
    </footer>

    <div class="floating-share-buttons">
        <a href="#" id="share-fb" class="share-fb" title="مشاركة على فيسبوك"><i class="fab fa-facebook-f"></i></a>
        <a href="#" id="share-wa" class="share-wa" title="مشاركة على واتساب"><i class="fab fa-whatsapp"></i></a>
        <a href="#" id="share-tg" class="share-tg" title="مشاركة على تيليجرام"><i class="fab fa-telegram-plane"></i></a>
        <a href="#" id="share-tw" class="share-tw" title="مشاركة على تويتر"><i class="fab fa-twitter"></i></a>
    </div>

    <div id="chat-widget">
        <div id="chat-popup">
            <div class="chat-header">
                <span>خدمة عملاء الأيقونة الذكي</span>
                <button id="close-chat" style="background:none; border:none; color:white; float:left; font-size:1.2rem; cursor:pointer;">&times;</button>
            </div>
            <div class="chat-messages" id="chat-messages">
                </div>
            <div id="name-prompt">
                <p>مرحباً بك! الرجاء إدخال اسمك للبدء.</p>
                <input type="text" id="name-input" placeholder="اكتب اسمك هنا...">
                <button id="send-name-btn" class="modal-btn" style="margin-top:10px;">بدء المحادثة</button>
            </div>
            <div class="chat-input-area" id="chat-input-area" style="display:none;">
                <button id="mic-btn" title="تحدث"><i class="fas fa-microphone"></i></button>
                <input type="text" id="chat-input" placeholder="اكتب سؤالك...">
                <button id="send-btn" title="إرسال"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
        <div id="chat-icon">
            <i class="fas fa-comments"></i>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>
    
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { getFirestore, collection, addDoc, getDocs, onSnapshot, doc, updateDoc, increment, serverTimestamp, runTransaction, query, orderBy, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
      
      const firebaseConfig = {
        apiKey: "AIzaSyDw2xnlpD8aSsOOElIz9Nw-LWGIJnScMks",
        authDomain: "icon-perfumes-7c445.firebaseapp.com",
        projectId: "icon-perfumes-7c445",
        storageBucket: "icon-perfumes-7c445.appspot.com",
        messagingSenderId: "570590846513",
        appId: "1:570590846513:web:e1e9063d71f694d68a3f10"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Make firebase functions globally available
      window.firebase = { db, collection, addDoc, getDocs, onSnapshot, doc, updateDoc, increment, serverTimestamp, runTransaction, query, orderBy, getDoc };
    </script>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Ensure firebase is initialized before using it
        if (!window.firebase) {
            console.error("Firebase is not initialized!");
            return;
        }

        const { db, collection, addDoc, getDocs, onSnapshot, doc, updateDoc, increment, serverTimestamp, runTransaction, query, orderBy, getDoc } = window.firebase;

        // --- Service Worker Registration for PWA ---
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(registration => console.log('Service Worker registered successfully:', registration))
                .catch(error => console.log('Service Worker registration failed:', error));
        }
        
        // --- App Download Simulation ---
        const downloadBtn = document.getElementById('downloadBtn');
        const progressBar = document.getElementById('progressBar');
        const downloadStatus = document.getElementById('downloadStatus');
        let downloading = false;
        downloadBtn.onclick = () => {
            if (downloading) return;
            downloading = true;
            downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري التحميل...';
            downloadBtn.disabled = true;
            progressBar.style.width = '0%';
            downloadStatus.innerText = '';
            let percent = 0;
            const totalKb = 9850;
            const interval = setInterval(() => {
                percent += 2;
                if (percent >= 100) {
                    clearInterval(interval);
                    percent = 100;
                    downloadBtn.innerHTML = '<i class="fas fa-download"></i> تثبيت تطبيق الأندرويد';
                    downloadStatus.innerText = 'اكتمل التحميل ✔️';
                    downloadBtn.disabled = false;
                    downloadBtn.onclick = () => { window.open('الأيقونة.apk', '_blank'); };
                }
                progressBar.style.width = percent + '%';
                let kb = Math.floor((percent/100)*totalKb);
                downloadStatus.innerText = `${kb} / ${totalKb} كيلو بايت`;
            }, 50);
        };

        // --- Product Data ---
        const products = [
            { id: 'p1', name: 'عطر العود الملكي', price: 5900, image: 'men1.jpg', rating: 4.8 },
            { id: 'p2', name: 'عطر نسيم البحر', price: 4900, image: 'men2.jpg', rating: 4.5 },
            { id: 'p3', name: 'عطر روح الصحراء', price: 5500, image: 'men3.jpg', rating: 4.9 },
            { id: 'p4', name: 'عطر ليالي الشرق', price: 5200, image: 'men4.jpg', rating: 4.7 },
            { id: 'p5', name: 'عطر خرير الماء', price: 4200, image: 'men5.jpg', rating: 4.6 }
        ];

        const productsGrid = document.getElementById('products-grid');
        products.forEach(product => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <img src="${product.image}" alt="${product.name}">
                <h3>${product.name}</h3>
                <div class="product-info">
                    <div class="rateYo" data-rateyo-rating="${product.rating}" data-rateyo-read-only="true"></div>
                    <button class="like-btn" data-product-id="${product.id}"><i class="far fa-heart"></i> <span id="like-count-${product.id}">0</span></button>
                </div>
                <div class="price">
                    <span>${product.price.toLocaleString()} ريال</span>
                </div>
                <div class="quantity-selector">
                    <button class="quantity-minus">-</button>
                    <input type="number" class="quantity-input" value="1" min="1" readonly>
                    <button class="quantity-plus">+</button>
                </div>
                <div class="total-price">الإجمالي: <span class="total-price-value">${product.price.toLocaleString()}</span> ريال</div>
                <button class="buy-btn" data-product-name="${product.name}" data-product-price="${product.price}">شراء الآن</button>
                <div class="social-share">
                    <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}" target="_blank" class="facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(product.name)}" target="_blank" class="twitter"><i class="fab fa-twitter"></i></a>
                    <a href="https://api.whatsapp.com/send?text=${encodeURIComponent(product.name + ' ' + window.location.href)}" target="_blank" class="whatsapp"><i class="fab fa-whatsapp"></i></a>
                    <a href="https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(product.name)}" target="_blank" class="telegram"><i class="fab fa-telegram-plane"></i></a>
                </div>
            `;
            productsGrid.appendChild(card);
        });
        
        // Initialize RateYo
        $(".rateYo").rateYo({
            rating: function () { return $(this).attr('data-rateyo-rating'); },
            starWidth: "20px",
            ratedFill: "var(--gold)",
            normalFill: "#555",
            readOnly: function () { return $(this).attr('data-rateyo-read-only') === 'true'; },
            rtl: true,
            spacing: "5px"
        });

        // --- Product Card Interactivity ---
        productsGrid.addEventListener('click', e => {
            const quantityInput = e.target.closest('.product-card')?.querySelector('.quantity-input');
            const price = parseFloat(e.target.closest('.product-card')?.querySelector('.buy-btn').dataset.productPrice);
            const totalPriceEl = e.target.closest('.product-card')?.querySelector('.total-price-value');
            
            if (e.target.classList.contains('quantity-plus')) {
                quantityInput.value = parseInt(quantityInput.value) + 1;
            }
            if (e.target.classList.contains('quantity-minus') && quantityInput.value > 1) {
                quantityInput.value = parseInt(quantityInput.value) - 1;
            }
            if (quantityInput) {
                const total = parseInt(quantityInput.value) * price;
                totalPriceEl.textContent = total.toLocaleString();
            }

            if (e.target.classList.contains('buy-btn')) {
                const productName = e.target.dataset.productName;
                const total = totalPriceEl.textContent;
                openPurchaseModal(productName, total, parseInt(quantityInput.value));
            }
            
            if (e.target.closest('.like-btn')) {
                handleLike(e.target.closest('.like-btn'));
            }
        });
        
        // --- Purchase Modal Logic ---
        const modal = document.getElementById('purchaseModal');
        const modalProductName = document.getElementById('modalProductName');
        const modalTotalPrice = document.getElementById('modalTotalPrice');
        const confirmBtn = document.getElementById('confirmPurchaseBtn');
        let currentProduct = {};

        function openPurchaseModal(name, total, quantity) {
            currentProduct = { name, total, quantity };
            modalProductName.textContent = name;
            modalTotalPrice.textContent = total + ' ريال';
            modal.style.display = 'flex';
        }

        modal.querySelector('.close').onclick = () => modal.style.display = 'none';
        window.onclick = e => { if (e.target == modal) modal.style.display = 'none'; };

        confirmBtn.onclick = () => {
            const customerName = document.getElementById('customerNameInput').value.trim();
            if (!customerName) {
                alert('الرجاء إدخال اسمك لإتمام الطلب.');
                return;
            }
            const message = `مرحباً مبيعات الأيقونة للعطور،\nأنا ${customerName}، وأرغب في طلب المنتج التالي:\n\nالمنتج: ${currentProduct.name}\nالكمية: ${currentProduct.quantity}\nالسعر الإجمالي: ${currentProduct.total} ريال\n\nالرابط المرجعي: ${window.location.href}\n\nشكراً لكم.`;
            const messengerLink = `https://m.me/alayqwnt.ll.twr?text=${encodeURIComponent(message)}`;
            window.open(messengerLink, '_blank');
            modal.style.display = 'none';
        };

        // --- Firestore & Page Logic ---
        // CODE ADDED: Visitor Counter Logic
           async function updateVisitorCount() {
               
            const localCount = localStorage.getItem('visitorCount') || 0;
            document.getElementById('visitor-counter').textContent = parseInt(localCount).toLocaleString();
            
            const counterRef = doc(db, "site-stats", "visitor-counter");
            try {
                await runTransaction(db, async (transaction) => {
                    const counterDoc = await transaction.get(counterRef);
                    if (!counterDoc.exists()) {
                        transaction.set(counterRef, { count: 1 });
                        localStorage.setItem('visitorCount', 1);
                        return 1;
                    }
                     
                    const lastUpdate = localStorage.getItem('lastVisitorUpdate') || 0;
                    const now = Date.now();
                    if ((now - lastUpdate) < 1800000) return; // 30 دقيقة
                    
                    const newCount = counterDoc.data().count + 1;
                    transaction.update(counterRef, { count: newCount });
                    localStorage.setItem('visitorCount', newCount);
                    localStorage.setItem('lastVisitorUpdate', now);
                    return newCount;
                });

                const updatedDoc = await getDoc(counterRef);
                if (updatedDoc.exists()) {
                    document.getElementById('visitor-counter').textContent = updatedDoc.data().count.toLocaleString();
                }

            } catch (e) {
                console.error("Error updating visitor count: ", e);
            }
        }
        updateVisitorCount();
        
       // ======== [2] نظام التعليقات المحسن ========
        let commentsLimit = 5;
        let commentsUnsubscribe = null;

        function setupComments(limit) {
            if (commentsUnsubscribe) commentsUnsubscribe();
            
            const q = query(commentsCollectionRef, orderBy('createdAt', 'desc'), limit(limit));
            commentsUnsubscribe = onSnapshot(q, (snapshot) => {
                commentsList.innerHTML = '';
                
                if (snapshot.empty) {
                    commentsList.innerHTML = '<p>لا توجد تعليقات بعد. كن أول من يعلق!</p>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    renderComment(doc);
                });
                
                // إضافة زر "تحميل المزيد" إذا كان هناك المزيد من التعليقات
                if (snapshot.size === limit) {
                    const loadMoreBtn = document.createElement('button');
                    loadMoreBtn.id = 'load-more-comments';
                    loadMoreBtn.className = 'modal-btn';
                    loadMoreBtn.textContent = 'تحميل المزيد من التعليقات';
                    loadMoreBtn.onclick = () => {
                        commentsLimit += 5;
                        setupComments(commentsLimit);
                    };
                    commentsList.appendChild(loadMoreBtn);
                }
                
                updateTimestamps();
            }, (error) => {
                console.error("Error loading comments: ", error);
                commentsList.innerHTML = '<p>حدث خطأ في تحميل التعليقات. يرجى المحاولة لاحقاً.</p>';
            });
        }

        // CODE ADDED: Client-side Search Logic
        const searchBar = document.getElementById('search-bar');
        searchBar.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const allProducts = document.querySelectorAll('.product-card');
            allProducts.forEach(product => {
                const productName = product.querySelector('h3').textContent.toLowerCase();
                if (productName.includes(searchTerm)) {
                    product.style.display = 'flex';
                } else {
                    product.style.display = 'flex';
                }
            });
        });

        // CODE MODIFIED & ADDED: Entire Comments section logic
        const commentsCollectionRef = collection(db, 'mens-perfume-comments');
        const commentForm = document.getElementById('comment-form');
        const commentsList = document.getElementById('comments-list');

        // Function to add initial comments if the collection is empty
        async function addInitialComments() {
            const snapshot = await getDocs(commentsCollectionRef);
            if (snapshot.empty) {
                console.log('No comments found. Adding initial comments.');
                const initialComments = [
                    { name: 'أحمد', text: 'عطر رائع وثباته ممتاز جداً، أنصح به بشدة!', likes: 15 },
                    { name: 'سارة', text: 'وصلني الطلب بسرعة، والتغليف كان أنيق. شكراً لكم.', likes: 12 },
                    { name: 'خالد', text: 'من أفضل العطور اللي جربتها، رائحة فريدة ومميزة.', likes: 25 },
                    { name: 'فاطمة', text: 'خدمة العملاء كانت متعاونة جداً. تجربة شراء ممتازة.', likes: 8 },
                    { name: 'محمد', text: 'هل يوجد توصيل إلى جميع المحافظات؟', likes: 5 }
                ];
                for (const comment of initialComments) {
                    await addDoc(commentsCollectionRef, { ...comment, createdAt: serverTimestamp() });
                }
            }
        }
        addInitialComments();

        // Function to format relative time
        function formatRelativeTime(date) {
            const now = new Date();
            const seconds = Math.round((now - date) / 1000);
            const minutes = Math.round(seconds / 60);
            const hours = Math.round(minutes / 60);
            const days = Math.round(hours / 24);

            if (seconds < 60) return `قبل ${seconds} ثواني`;
            if (minutes < 60) return `قبل ${minutes} دقائق`;
            if (hours < 24) return `قبل ${hours} ساعات`;
            if (days === 1) return `أمس`;
            return date.toLocaleDateString('ar-SA');
        }

        function updateTimestamps() {
            document.querySelectorAll('.comment-date').forEach(el => {
                const timestamp = parseInt(el.dataset.timestamp, 10);
                if (timestamp) {
                    el.textContent = formatRelativeTime(new Date(timestamp));
                }
            });
        }
        setInterval(updateTimestamps, 60000); // Update every minute

        // Listen for and display comments and replies
        const q = query(commentsCollectionRef, orderBy('createdAt', 'desc'));
        onSnapshot(q, (snapshot) => {
            commentsList.innerHTML = '';
            snapshot.forEach(doc => {
                renderComment(doc);
            });
            updateTimestamps();
        });

        function renderComment(commentDoc) {
            const comment = commentDoc.data();
            const commentId = commentDoc.id;
            const liked = localStorage.getItem(`liked_comment_${commentId}`) === 'true';

            const div = document.createElement('div');
            div.className = 'comment';
            div.id = `comment-${commentId}`;
            div.innerHTML = `
                <div class="comment-header">
                    <span class="comment-author">${comment.name}</span>
                    <span class="comment-date" data-timestamp="${comment.createdAt?.toMillis()}">${formatRelativeTime(comment.createdAt?.toDate() || new Date())}</span>
                </div>
                <p class="comment-text">${comment.text}</p>
                <div class="comment-actions">
                    <button class="action-like ${liked ? 'liked' : ''}" data-id="${commentId}" data-type="comment">
                        <i class="fas fa-heart"></i> <span>${comment.likes || 0}</span>
                    </button>
                    <button class="action-reply" data-id="${commentId}"><i class="fas fa-reply"></i> رد</button>
                </div>
                <div class="reply-form" id="reply-form-${commentId}">
                    <form>
                        <input type="text" placeholder="اسمك" required>
                        <textarea rows="2" placeholder="اكتب ردك..." required></textarea>
                        <button type="submit">إرسال الرد</button>
                    </form>
                </div>
                <div class="replies-container" id="replies-${commentId}"></div>
            `;
            commentsList.appendChild(div);

            // Fetch and render replies
            const repliesRef = collection(db, 'mens-perfume-comments', commentId, 'replies');
            const repliesQuery = query(repliesRef, orderBy('createdAt', 'asc'));
            onSnapshot(repliesQuery, (replySnapshot) => {
                const repliesContainer = document.getElementById(`replies-${commentId}`);
                repliesContainer.innerHTML = '';
                replySnapshot.forEach(replyDoc => {
                    renderReply(replyDoc, commentId);
                });
                updateTimestamps();
            });
        }
        
        function renderReply(replyDoc, commentId) {
            const reply = replyDoc.data();
            const replyId = replyDoc.id;
            const liked = localStorage.getItem(`liked_reply_${replyId}`) === 'true';
            const repliesContainer = document.getElementById(`replies-${commentId}`);

            const div = document.createElement('div');
            div.className = 'reply';
            div.innerHTML = `
                <div class="comment-header">
                    <span class="comment-author">${reply.name}</span>
                    <span class="comment-date" data-timestamp="${reply.createdAt?.toMillis()}">${formatRelativeTime(reply.createdAt?.toDate() || new Date())}</span>
                </div>
                <p class="comment-text">${reply.text}</p>
                <div class="comment-actions">
                    <button class="action-like ${liked ? 'liked' : ''}" data-id="${replyId}" data-comment-id="${commentId}" data-type="reply">
                        <i class="fas fa-heart"></i> <span>${reply.likes || 0}</span>
                    </button>
                </div>
            `;
            repliesContainer.appendChild(div);
        }

        // Handle Comment form submission
        commentForm.addEventListener('submit', async e => {
            e.preventDefault();
            const name = document.getElementById('comment-name').value.trim();
            const text = document.getElementById('comment-text').value.trim();
            if (!name || !text) return;
            
            await addDoc(commentsCollectionRef, {
                name,
                text,
                likes: 0,
                createdAt: serverTimestamp()
            });

            commentForm.reset();
        });

        // Handle clicks on actions (like, reply) using event delegation
        commentsList.addEventListener('click', async e => {
            const target = e.target.closest('button');
            if (!target) return;

            // Handle Like button
            if (target.classList.contains('action-like')) {
                const id = target.dataset.id;
                const type = target.dataset.type;
                const storageKey = `liked_${type}_${id}`;

                if (localStorage.getItem(storageKey)) {
                    console.log("Already liked this item.");
                    return; // Already liked
                }

                let itemRef;
                if (type === 'comment') {
                    itemRef = doc(db, 'mens-perfume-comments', id);
                } else {
                    const commentId = target.dataset.commentId;
                    itemRef = doc(db, 'mens-perfume-comments', commentId, 'replies', id);
                }

                await updateDoc(itemRef, { likes: increment(1) });
                localStorage.setItem(storageKey, 'true');
                target.classList.add('liked');
            }

            // Handle Reply button
            if (target.classList.contains('action-reply')) {
                const commentId = target.dataset.id;
                const replyForm = document.getElementById(`reply-form-${commentId}`);
                replyForm.style.display = replyForm.style.display === 'block' ? 'none' : 'block';
            }
        });
        
        // Handle Reply form submission
        commentsList.addEventListener('submit', async e => {
            e.preventDefault();
            if (e.target.closest('.reply-form')) {
                const form = e.target;
                const commentId = form.closest('.comment').id.replace('comment-', '');
                const name = form.querySelector('input').value.trim();
                const text = form.querySelector('textarea').value.trim();
                if (!name || !text || !commentId) return;

                const repliesRef = collection(db, 'mens-perfume-comments', commentId, 'replies');
                await addDoc(repliesRef, {
                    name,
                    text,
                    likes: 0,
                    createdAt: serverTimestamp()
                });
                
                form.reset();
                form.closest('.reply-form').style.display = 'none';
            }
        });

        // --- Product & Misc Logic (No changes below this line, kept for completeness) ---

        // Handle Product Likes
        async function handleLike(btn) {
            const productId = btn.dataset.productId;
            const likedKey = `liked_product_${productId}`;
            if (localStorage.getItem(likedKey)) { console.log("Already liked"); return; }
            const likeDocRef = doc(db, "product-likes", productId);
            await updateDoc(likeDocRef, { count: increment(1) });
            localStorage.setItem(likedKey, 'true');
            btn.classList.add('liked');
            btn.querySelector('i').className = 'fas fa-heart';
        }
        products.forEach(p => {
            const likeDocRef = doc(db, "product-likes", p.id);
            onSnapshot(likeDocRef, (doc) => {
                const count = doc.exists() ? doc.data().count : 0;
                document.getElementById(`like-count-${p.id}`).textContent = count;
                if (localStorage.getItem(`liked_product_${p.id}`)) {
                    const btn = document.querySelector(`.like-btn[data-product-id="${p.id}"]`);
                    if(btn) {
                        btn.classList.add('liked');
                        btn.querySelector('i').className = 'fas fa-heart';
                    }
                }
            });
        });

        // --- Floating Share Buttons Logic ---
        const shareText = `الأيقونة للعطور - جودة وأصالة\nعطور رجالية ونسائية وبخور ومستحضرات التجميل.\nيوجد لدينا توصيل الى جميع المحافظات اليمنيه.\n\nاكتشف قسم العطور الرجالية:\n${window.location.href}`;
        document.getElementById('share-fb').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(shareText)}`;
        document.getElementById('share-wa').href = `https://api.whatsapp.com/send?text=${encodeURIComponent(shareText)}`;
        document.getElementById('share-tg').href = `https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(shareText)}`;
        document.getElementById('share-tw').href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(shareText)}`;

        // --- Chat Widget Logic ---
        const chatIcon = document.getElementById('chat-icon');
        const chatPopup = document.getElementById('chat-popup');
        const closeChatBtn = document.getElementById('close-chat');
        const chatMessages = document.getElementById('chat-messages');
        const namePrompt = document.getElementById('name-prompt');
        const nameInput = document.getElementById('name-input');
        const sendNameBtn = document.getElementById('send-name-btn');
        const chatInputArea = document.getElementById('chat-input-area');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const micBtn = document.getElementById('mic-btn');
        const GEMINI_API_KEY = 'AIzaSyDSGuS0cRduU1dPGzHjXRjWvjDgzL4NyIY';
        const audioPlayer = new Audio();
        let userName = localStorage.getItem('perfume_userName');
        function speak(text) { if ('speechSynthesis' in window) { const utterance = new SpeechSynthesisUtterance(text); utterance.lang = 'ar-SA'; window.speechSynthesis.speak(utterance); } }
        function addMessage(text, sender) { const messageDiv = document.createElement('div'); messageDiv.className = `chat-message ${sender}-message`; messageDiv.textContent = text; chatMessages.appendChild(messageDiv); chatMessages.scrollTop = chatMessages.scrollHeight; }
        chatIcon.onclick = () => { chatPopup.style.display = 'flex'; chatIcon.style.display = 'none'; };
        closeChatBtn.onclick = () => { chatPopup.style.display = 'none'; chatIcon.style.display = 'block'; };
        if (userName) { namePrompt.style.display = 'none'; chatInputArea.style.display = 'flex'; const welcomeBackMsg = `أهلاً بعودتك يا ${userName}! كيف أقدر أساعدك اليوم؟ يمكنك طلب تشغيل الموسيقى اكتب كلمة "تشغيل".`; addMessage(welcomeBackMsg, 'bot'); speak(welcomeBackMsg); } else { const welcomeMsg = "أهلاً بك في متجر الأيقونة! أنا مؤظف خدمة العملاء الذكي. لطفاً، أدخل اسمك للبدء."; addMessage(welcomeMsg, 'bot'); speak(welcomeMsg); }
        sendNameBtn.onclick = () => { const name = nameInput.value.trim(); if (name) { userName = name; localStorage.setItem('perfume_userName', userName); namePrompt.style.display = 'none'; chatInputArea.style.display = 'flex'; addMessage(`رائع يا ${userName}! كيف أقدر أساعدك؟ يمكنك سماع الموسيقى ارسل كلمة "تشغيل"`, 'bot'); } };
        sendBtn.onclick = handleUserInput;
        chatInput.onkeypress = e => { if (e.key === 'Enter') handleUserInput(); };
        function handleUserInput() { const query = chatInput.value.trim(); if (!query) return; addMessage(query, 'user'); processQuery(query); chatInput.value = ''; }
        const playCommands = ['تشغيل', 'شغل', 'موسيقى', 'طرب', 'اغاني', 'غني'];
        const stopCommands = ['ايقاف', 'إيقاف', 'اغلاق', 'إغلاق', 'طفي', 'صمت'];
        const preDefinedAnswers = { 'دفع': 'نقدم عدة طرق للدفع: إيداع بنك الكريمي، حوالات مصرفية، أو عبر المحافظ الإلكترونية.', 'توصيل': 'مدة التوصيل تتراوح بين 1-3 أيام في المدن الكبرى و3-7 أيام لباقي المناطق.', 'جودة': 'جميع منتجاتنا أصلية 100% وذات جودة عالية مع ضمان استرجاع.', 'عروض': 'لدينا عروض دورية. تابع صفحاتنا على التواصل الاجتماعي لمعرفة أحدث العروض.', 'سعر': 'الأسعار موضحة في صفحة كل منتج. لأي استفسار آخر، أنا في الخدمة.', 'استبدال': 'نقدم خدمة استبدال المنتج خلال 7 أيام من الاستلام في حال وجود عيب مصنعي.', 'عنوان': 'مقرنا الرئيسي في محافظة ذمار، اليمن، ونقوم بالتوصيل لجميع المحافظات.', 'مصمم': 'تم تصميم المتجر بواسطة المبرمج والمصمم طلال سليمان المقطري. للتواصل معه: 774662666.' };
        async function processQuery(query) { if (playCommands.some(cmd => query.includes(cmd))) { audioPlayer.src = 'http://stream.zeno.fm/ae32e025wp8uv'; audioPlayer.play(); addMessage('تم تشغيل الموسيقى لك 🎶', 'bot'); return; } if (stopCommands.some(cmd => query.includes(cmd))) { audioPlayer.pause(); audioPlayer.src = ''; addMessage('تم إيقاف الموسيقى.', 'bot'); return; } for (const key in preDefinedAnswers) { if (query.includes(key)) { addMessage(preDefinedAnswers[key], 'bot'); speak(preDefinedAnswers[key]); return; } } addMessage('لحظات، خدمة العملاء يكتب الإجابة... 🤔', 'bot'); try { const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ "contents": [{ "parts": [{ "text": `أنت مساعد ذكي وودود في متجر عطور اسمه "الأيقونة". أجب على هذا السؤال من العميل "${userName}": ${query}` }] }] }) }); const data = await response.json(); const botResponse = data.candidates[0].content.parts[0].text; chatMessages.removeChild(chatMessages.lastChild); addMessage(botResponse, 'bot'); speak(botResponse); } catch (error) { console.error("Gemini API Error:", error); chatMessages.removeChild(chatMessages.lastChild); addMessage('عفواً، حدث خطأ ما. حاول مرة أخرى.', 'bot'); } }
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition; if (SpeechRecognition) { const recognition = new SpeechRecognition(); recognition.lang = 'ar-SA'; recognition.continuous = false; micBtn.onclick = () => { recognition.start(); micBtn.style.color = '#ff6b6b'; }; recognition.onresult = (event) => { const transcript = event.results[0][0].transcript; chatInput.value = transcript; handleUserInput(); }; recognition.onend = () => { micBtn.style.color = 'var(--gold)'; }; } else { micBtn.style.display = 'none'; }
    });
    
    const sliderImgs = ["men1.jpg","men2.jpg","men3.jpg","men4.jpg","men5.jpg"];
  const highImgs = ["men1.png","men2.png","men3.png","men4.png","men5.png"];
  let mainImg = document.getElementById('mainImg');
  let thumbs = document.querySelectorAll('.thumb');
  let sliderIndex = 0;
  let sliderActive = true;
  let sliderInterval = setInterval(()=>{
    if (sliderActive) {
      sliderIndex = (sliderIndex+1)%sliderImgs.length;
      mainImg.src = sliderImgs[sliderIndex];
    }
  }, 1800);

  thumbs.forEach((thumb,idx)=>{
    thumb.onclick = ()=>{
      sliderActive = false;
      clearInterval(sliderInterval);
      mainImg.src = highImgs[idx];
      // ظل للصورة المختارة
      thumbs.forEach(t=>t.style.boxShadow="none");
      thumb.style.boxShadow="0 0 12px var(--gold)";
    };
  });
  // إعادة التشغيل عند مغادرة الماوس المربع الكبير
  mainImg.onmouseleave = ()=>{
    if(!sliderActive){
      sliderActive = true;
      sliderInterval = setInterval(()=>{
        sliderIndex = (sliderIndex+1)%sliderImgs.length;
        mainImg.src = sliderImgs[sliderIndex];
        thumbs.forEach(t=>t.style.boxShadow="none");
      }, 1800);
    }
  };
  
  $('.rateYo').each(function(){
    $(this).rateYo({
      rtl:true,
      rating: $(this).data('rate'),
      starWidth: "18px",
      ratedFill: "#D4AF37",
      normalFill: "#fff2b2",
      readOnly: true,
      spacing:"3px"
    });
  });

    </script>

</body>
</html>
